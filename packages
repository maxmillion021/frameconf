#!/bin/bash

PACKAGE_FILE="packages.conf"

# Check if running with root/sudo privileges
if [ "$EUID" -ne 0 ]; then
  echo "Please run this script with sudo or as root"
  exit 1
fi

# Check if packages file exists
if [ -f "$PACKAGE_FILE" ]; then
  readarray -t packages <$PACKAGE_FILE
else
  echo "Error: Configuration file $PACKAGE_FILE not found"
  exit 1
fi

progress_bar() {
  local current=$1
  local total=$2
  local width=$((COLUMNS / 3))

  local percent=$((current * 100 / total))
  local filled=$((width * current / total))
  local empty=$((width - filled))

  printf "\r["
  printf "%*s" "$filled" | tr ' ' '#'
  printf "%*s" "$empty" | tr ' ' ' '
  printf "] %3d%% (%d/%d) installing: %s" "$percent" "$current" "$total" "$package"
}

installed_packages=()
failed_packages=()
pack_len=${#packages[@]}

for package in "${packages[@]}"; do
  if pacman -S --noconfirm --needed "$package" >/dev/null 2>&1; then
    installed_packages+=("$package")
  else
    failed_packages+=("$package")
  fi
  progress_bar "$((current + 1))" "$pack_len" "$package"
  ((current++))
done
printf "\r"
printf "Installed packages: %s" "${installed_packages[*]}"
printf "\n"
printf "Failed packages: %s" "${failed_packages[*]}"
